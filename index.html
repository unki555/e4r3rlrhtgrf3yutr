<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Case App</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-bg: #141414;
            --card-bg: #272727;
            --wheel-bg: #3F4C5C;
            --menu-bg: rgba(27, 27, 27, 0.95);
            --text-color: white;
            --accent-color: #1689FE;
            --price-color: #FFFFFF;
            --search-bg: rgba(255, 255, 255, 0.1);
            --success-color: #4CAF50;
            --warning-color: #CD1A03;
            --button-bg: rgba(255, 255, 255, 0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-color);
            padding-bottom: 80px;
            overflow-x: hidden;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
            overflow-y: auto;
        }
        
        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background-color: var(--primary-bg);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .user-name {
            font-weight: 700;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .verified-badge {
            color: #1689FE;
            font-size: 12px;
        }
        
        .balance-container {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 4px 8px 4px 12px;
        }
        
        .balance {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 700;
        }
        
        .coin-icon {
            width: 18px;
            height: 18px;
            object-fit: contain;
        }
        
        .deposit-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
            font-weight: 700;
        }
        
        .deposit-btn:hover {
            background-color: #0280d0;
        }
        
        /* Cases Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 16px;
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
            height: 240px;
            position: relative;
        }
        
        .card:hover {
            transform: translateY(-3px);
        }
        
        .card-image-container {
            width: 100%;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .card-image {
            width: 100%;
            height: 120px;
            object-fit: contain;
        }
        
        .card-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
            z-index: 1;
            background-color: #1689FE;
        }
        
        .card-details {
            padding: 12px;
            text-align: center;
            min-height: 60px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .card-name {
            font-weight: 700;
            font-size: 14px;
            margin: 0 0 6px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .card-price {
            color: var(--price-color);
            font-weight: 700;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        /* Case Opening Modal - НОВЫЙ ДИЗАЙН */
        .case-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--primary-bg);
            z-index: 1000;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }
        
        .case-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .case-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-color);
        }
        
        .case-close {
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
            background: none;
            border: none;
            font-weight: 700;
        }
        
        /* Новый контейнер для прокрутки карточек */
        .cards-strip-container {
            position: relative;
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        
        .cards-strip {
            display: flex;
            height: 100%;
            transition: transform 0.1s linear;
        }
        
        .card-strip-item {
            min-width: 140px;
            height: 100%;
            margin: 0 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .card-strip-item.highlight {
            animation: highlight-item 1.5s ease-in-out;
            box-shadow: 0 0 15px var(--accent-color);
            transform: scale(1.05);
        }
        
        @keyframes highlight-item {
            0%, 100% { transform: scale(1); box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
            50% { transform: scale(1.08); box-shadow: 0 0 20px var(--accent-color); }
        }
        
        .card-strip-image {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }
        
        .card-strip-name {
            margin-top: 8px;
            font-size: 10px;
            text-align: center;
            font-weight: 600;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Новые указатели */
        /* Новые указатели */
.pointer {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  width: 16px;
  height: 8px;
  z-index: 10;
}

.pointer.bottom {
  bottom: 0;
  border-top: none;
  border-bottom: 7.5px solid var(--accent-color);
  border-left: 7.5px solid transparent;
  border-right: 7.5px solid transparent;
}

.pointer.top {
  top: 0;
  border-bottom: none;
  border-top: 7.5px solid var(--accent-color);
  border-left: 7.5px solid transparent;
  border-right: 7.5px solid transparent;
}

/* Styles for the line */
.pointer.top::after,
.pointer.bottom::after {
  content: "";
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  width: 133px; /* Увеличиваем длину линии */
  height: 4px; /* Увеличиваем толщину линии */
  background-color: var(--accent-color); /* Цвет линии - в цвет ползунка */
}

.pointer.top::after {
  top: -9px; /* Положение линии над верхним указателем */
}

.pointer.bottom::after {
  bottom: -9px; /* Положение линии под нижним указателем */
}
        
        .spin-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px 0;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin: 0 0 10px 0;
            width: 100%;
            max-width: 300px;
            transition: transform 0.2s;
        }
        
        .spin-btn:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        
        .spin-btn:active:not(:disabled) {
            transform: scale(0.98);
        }
        
        .possible-items-title {
            font-size: 18px;
            font-weight: 700;
            margin: 10px 0 5px;
            width: 100%;
            text-align: center;
        }
        
        .possible-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            width: 100%;
            padding: 0 10px;
        }
        
        .possible-item {
            background-color: var(--card-bg);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }
        
        .possible-item-image {
            width: 30px;
            height: 30px;
            object-fit: contain;
            margin-bottom: 6px;
        }
        
        .possible-item-name {
            font-size: 9px;
            text-align: center;
            font-weight: 600;
        }
        
        /* Payment Modal */
        .payment-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .payment-content {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .payment-title {
            font-size: 20px;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .amount-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .amount-option {
            background-color: var(--primary-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .amount-option.selected {
            border-color: var(--accent-color);
            background-color: rgba(1, 151, 236, 0.2);
        }
        
        .amount-value {
            font-weight: 700;
            font-size: 18px;
        }
        
        .amount-bonus {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .payment-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .payment-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-weight: 700;
            cursor: pointer;
        }
        
        .payment-btn-primary {
            background-color: var(--accent-color);
            color: white;
        }
        
        .payment-btn-secondary {
            background-color: transparent;
            color: var(--text-color);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Won Item Modal */
        .won-item-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1001;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
        }
        
        .won-item-content {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 25px 20px;
            width: 100%;
            max-width: 280px;
        }
        
        .won-item-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .won-item-image {
            width: 120px;
            height: 120px;
            object-fit: contain;
            margin: 0 auto 15px;
            animation: won-item-pulse 2s infinite;
        }
        
        @keyframes won-item-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }
        
        .won-item-name {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .won-item-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .won-item-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .won-item-btn.keep {
            background-color: transparent;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
        }
        
        .won-item-btn.sell {
            background-color: var(--accent-color);
            color: white;
        }
        
        /* Menu */
        .menu-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--menu-bg);
            backdrop-filter: blur(10px);
            z-index: 100;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
            gap: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 60px;
        }
        
        .menu-item.active {
            color: var(--text-color);
        }
        
        .menu-icon {
            font-size: 20px;
        }
        
        /* Market Section */
        .market-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 16px;
        }
        
        .market-item {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            position: relative;
        }
        
        .market-item-image {
            width: 100px;
            height: 100px;
            object-fit: contain;
            margin-bottom: 10px;
        }
        
        .market-item-name {
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 8px;
        }
        
        .market-item-price {
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 700;
        }
        
        /* Profile Section */
        .profile-container {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 3px solid var(--accent-color);
        }
        
        .profile-name {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .profile-id {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 25px;
        }
        
        .profile-section {
            width: 100%;
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
            text-align: left;
        }
        
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .settings-item:last-child {
            border-bottom: none;
        }
        
        .settings-label {
            font-size: 16px;
            font-weight: 600;
        }
        
        .settings-value {
            font-size: 16px;
            color: var(--accent-color);
            font-weight: 700;
        }
        
        .language-selector {
            display: flex;
            gap: 10px;
            padding: 8px;
            background-color: var(--button-bg);
            border-radius: 8px;
        }
        
        .language-option {
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        
        .language-option.active {
            background-color: var(--accent-color);
            color: white;
        }
        
        .profile-deposit-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            margin-top: 20px;
        }
        
        /* Inventory Section */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 16px;
        }
        
        .inventory-item {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        
        .inventory-item-image {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-bottom: 10px;
        }
        
        .inventory-item-name {
            font-size: 13px;
            text-align: center;
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        .inventory-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }
        
        .inventory-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .inventory-btn.sell {
            background-color: #4CAF50;
        }
        
        .inventory-btn.withdraw {
            background-color: #9C27B0;
        }
        
        /* Market Modal */
        .market-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1001;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .market-modal-content {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            width: 100%;
            max-width: 400px;
        }
        
        .market-modal-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            background-color: var(--primary-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-family: 'Montserrat', sans-serif;
        }
        
        .form-textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            background-color: var(--primary-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-family: 'Montserrat', sans-serif;
            resize: none;
        }
        
        .price-slider {
            width: 100%;
            margin: 10px 0;
        }
        
        /* Market Listing */
        .market-listing {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .listing-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .listing-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
        }
        
        .listing-user {
            font-weight: 700;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .listing-content {
            display: flex;
            gap: 15px;
        }
        
        .listing-image {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: 8px;
        }
        
        .listing-details {
            flex: 1;
        }
        
        .listing-name {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 6px;
        }
        
        .listing-description {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 12px;
        }
        
        .listing-price {
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 700;
            font-size: 18px;
        }
        
        .listing-buy-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        
        /* Filter */
        .market-filter {
            padding: 16px;
            background-color: var(--card-bg);
            border-radius: 12px;
            margin: 16px;
        }
        
        .filter-title {
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .filter-slider {
            width: 100%;
            margin: 10px 0;
        }
        
        .filter-price {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* Sections */
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .profile-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
        }
        
        .profile-tab {
            flex: 1;
            padding: 10px;
            background-color: var(--button-bg);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }
        
        .profile-tab.active {
            background-color: var(--accent-color);
        }
        
        .profile-tab-content {
            display: none;
            width: 100%;
        }
        
        .profile-tab-content.active {
            display: block;
        }
        
        /* Responsive */
        @media (max-width: 360px) {
            .card-image-container {
                height: 100px;
            }
            
            .card-strip-item {
                min-width: 120px;
            }
            
            .card-name {
                font-size: 13px;
            }
        }
        
        @media (min-width: 768px) {
            .cards-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .market-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .possible-items {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .inventory-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* Фикс для скроллинга */
        html, body {
            height: 100%;
            overflow: auto;
        }
        
        .section-content {
            min-height: calc(100vh - 180px);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--card-bg);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            font-weight: 700;
            display: none;
            animation: slideIn 0.3s, fadeOut 0.5s 2.5s;
        }
        
        @keyframes slideIn {
            from { top: -50px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        /* Empty Inventory */
        .empty-inventory {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
        }
        
        .empty-inventory-icon {
            font-size: 64px;
            color: rgba(255, 255, 255, 0.3);
            margin-bottom: 20px;
        }
        
        .empty-inventory-text {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 30px;
        }
        
        .empty-inventory-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px 24px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .empty-inventory-btn:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="user-info">
            <img src="https://via.placeholder.com/36" class="user-avatar" id="user-avatar" alt="User Avatar">
            <div class="user-name" id="user-name">User</div>
        </div>
        <div class="balance-container">
            <div class="balance">
                <span id="balance-value">500</span>
                <img src="stars.png" class="coin-icon" alt="Coin">
            </div>
            <button class="deposit-btn" id="deposit-btn">+</button>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification"></div>
    
    <!-- Gifts Section (Кейсы) -->
    <div class="section active" id="gifts-section">
        <div class="cards-grid" id="cases-grid"></div>
    </div>
    
    <!-- Market Section (Маркет) -->
    <div class="section" id="market-section">
        <div class="market-filter">
            <div class="filter-title" id="filter-title">Фильтр по цене</div>
            <input type="range" min="0" max="5000" value="2500" class="filter-slider" id="price-filter">
            <div class="filter-price">
                <span>0</span>
                <span id="filter-max-price">2500</span>
            </div>
        </div>
        <div id="market-listings"></div>
    </div>
    
    <!-- Profile Section (Профиль) -->
    <div class="section" id="profile-section">
        <div class="profile-container">
            <img src="https://via.placeholder.com/120" class="profile-avatar" id="profile-avatar" alt="Profile Avatar">
            <div class="profile-name" id="profile-name">
                Имя Пользователя
                <i class="fas fa-check-circle verified-badge"></i>
            </div>
            <div class="profile-id" id="profile-id">ID: 123456789</div>
            
            <div class="profile-tabs">
                <button class="profile-tab active" data-tab="settings">Настройки</button>
                <button class="profile-tab" data-tab="inventory">Инвентарь</button>
                <button class="profile-tab" data-tab="history">История</button>
            </div>
            
            <div class="profile-tab-content active" id="settings-tab">
                <div class="profile-section">
                    <div class="section-title">Настройки</div>
                    <div class="settings-item">
                        <div class="settings-label">Язык</div>
                        <div class="language-selector">
                            <div class="language-option active" data-lang="ru">RU</div>
                            <div class="language-option" data-lang="en">EN</div>
                        </div>
                    </div>
                </div>
                
                <button class="profile-deposit-btn" id="profile-deposit-btn">
                    Пополнить баланс
                </button>
            </div>
            
            <div class="profile-tab-content" id="inventory-tab">
                <div class="inventory-grid" id="inventory-grid"></div>
            </div>
            
            <div class="profile-tab-content" id="history-tab">
                <div class="profile-section">
                    <div class="section-title">История операций</div>
                    <div id="history-list"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Case Opening Modal -->
    <div class="case-modal" id="case-modal">
        <div class="case-header">
            <button class="case-close" id="close-case-modal">&times;</button>
        </div>
        
        <!-- Новый контейнер для прокрутки карточек с указателями -->
        <div class="cards-strip-container">
            <div class="cards-strip" id="cards-strip"></div>
            <div class="pointer top"></div>
            <div class="pointer bottom"></div>
        </div>
        
        <button class="spin-btn" id="spin-btn">Открыть за <span id="spin-price">0</span> <img src="stars.png" style="width:16px;height:16px;" alt=""></button>
        
        <div class="possible-items-title" id="possible-items-title">Возможные предметы</div>
        <div class="possible-items" id="possible-items"></div>
    </div>
    
    <!-- Payment Modal -->
    <div class="payment-modal" id="payment-modal">
        <div class="payment-content">
            <div class="payment-title" id="payment-modal-title">Пополнение баланса</div>
            <div class="amount-selector">
                <div class="amount-option selected" data-amount="100">
                    <div class="amount-value">100</div>
                    <div class="amount-bonus" id="bonus-0">+0%</div>
                </div>
                <div class="amount-option" data-amount="200">
                    <div class="amount-value">200</div>
                    <div class="amount-bonus" id="bonus-10">+10%</div>
                </div>
                <div class="amount-option" data-amount="500">
                    <div class="amount-value">500</div>
                    <div class="amount-bonus" id="bonus-20">+20%</div>
                </div>
                <div class="amount-option" data-amount="1000">
                    <div class="amount-value">1000</div>
                    <div class="amount-bonus" id="bonus-30">+30%</div>
                </div>
            </div>
            <div class="payment-buttons">
                <button class="payment-btn payment-btn-secondary" id="cancel-payment">Отмена</button>
                <button class="payment-btn payment-btn-primary" id="confirm-payment">Оплатить</button>
            </div>
        </div>
    </div>
    
    <!-- Won Item Modal -->
    <div class="won-item-modal" id="won-item-modal">
        <div class="won-item-content">
            <div class="won-item-title" id="won-item-title">Поздравляем!</div>
            <img src="" class="won-item-image" id="won-item-image" alt="Выигранный предмет">
            <div class="won-item-name" id="won-item-name"></div>
            <div class="won-item-buttons">
                <button class="won-item-btn sell" id="sell-item">Продать</button>
                <button class="won-item-btn keep" id="keep-item">Оставить</button>
            </div>
        </div>
    </div>
    
    <!-- Market Modal -->
    <div class="market-modal" id="market-modal">
        <div class="market-modal-content">
            <div class="market-modal-title" id="market-modal-title">Выставить на маркет</div>
            <div class="form-group">
                <label class="form-label" id="price-label">Цена</label>
                <input type="number" min="1" max="10000" class="form-input" id="market-price" value="100">
            </div>
            <div class="form-group">
                <label class="form-label" id="description-label">Описание (необязательно)</label>
                <textarea class="form-textarea" id="market-description" placeholder="Опишите ваш предмет..."></textarea>
            </div>
            <div class="payment-buttons">
                <button class="payment-btn payment-btn-secondary" id="cancel-market">Отмена</button>
                <button class="payment-btn payment-btn-primary" id="confirm-market">Выставить</button>
            </div>
        </div>
    </div>
    
    <!-- Menu with Font Awesome icons -->
    <div class="menu-container">
        <div class="menu-item active" data-tab="gifts-section">
            <div class="menu-icon">
                <i class="fas fa-gift"></i>
            </div>
            <div id="menu-gifts">Gifts</div>
        </div>
        <div class="menu-item" data-tab="market-section">
            <div class="menu-icon">
                <i class="fas fa-store"></i>
            </div>
            <div id="menu-market">Market</div>
        </div>
        <div class="menu-item" data-tab="profile-section">
            <div class="menu-icon">
                <i class="fas fa-user"></i>
            </div>
            <div id="menu-profile">Profile</div>
        </div>
    </div>
    
    <script>
        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            // База данных пользователей
            const usersDatabase = {
                // Текущий пользователь
                currentUser: {
                    id: 123456789,
                    name: "Имя Пользователя",
                    avatar: "https://via.placeholder.com/120",
                    balance: 500,
                    verified: true,
                    inventory: [],
                    history: []
                },
                
                // Другие пользователи
                users: [
                    {
                        id: 987654321,
                        name: "Алексей",
                        avatar: "https://via.placeholder.com/120/FF5733/FFFFFF",
                        balance: 1200,
                        verified: true,
                        inventory: [],
                        history: []
                    },
                    {
                        id: 555555555,
                        name: "Мария",
                        avatar: "https://via.placeholder.com/120/C70039/FFFFFF",
                        balance: 750,
                        verified: false,
                        inventory: [],
                        history: []
                    },
                    {
                        id: 111111111,
                        name: "Дмитрий",
                        avatar: "https://via.placeholder.com/120/900C3F/FFFFFF",
                        balance: 2500,
                        verified: true,
                        inventory: [],
                        history: []
                    }
                ]
            };
            
            // Данные кейсов
            const casesDatabase = [
                { 
                    id: 1, 
                    name: "God CaseX", 
                    price: 0, 
                    image: "https://via.placeholder.com/300x200/2D3947/FFFFFF?text=God+XCase",
                    badge: "Новый",
                    items: [
                        { id: 1, name: "Notepad", image: "notepad.png", chance: 10, value: 1099 },
                        { id: 2, name: "Мишка", image: "teddybear.png", chance: 35, value: 15 },
                        { id: 3, name: "Сердце", image: "pon.png", chance: 35, value: 15 }
                    ]
                },
                { 
                    id: 2, 
                    name: "Ghostly CaseX", 
                    price: 0, 
                    image: "https://via.placeholder.com/300x200/2D3947/FFFFFF?text=Ghostly+XCase",
                    badge: "Новый",
                    items: [
                        { id: 4, name: "Snake Box", image: "snakebox.png", chance: 10, value: 699 },
                        { id: 5, name: "Мишка", image: "https://via.placeholder.com/200/FF6347/FFFFFF?text=Torch", chance: 35, value: 15 },
                        { id: 6, name: "Сердце", image: "https://via.placeholder.com/200/ADD8E6/000000?text=Ring", chance: 35, value: 15 }
                    ]
                }
            ];
            
            // Данные для маркета
            const marketItems = [
                { 
                    id: 100, 
                    name: "Cookie Heart", 
                    image: "cockieheart.png", 
                    price: 1199,
                    seller: usersDatabase.users[0],
                    description: " Это тестовая версия, скоро добавим не писяй"
                },
                { 
                    id: 101, 
                    name: "Lol Pop", 
                    image: "lolpop.png", 
                    price: 689,
                    seller: usersDatabase.users[1],
                    description: "тест"
                },
                { 
                    id: 102, 
                    name: "Cookie", 
                    image: "coockie.png", 
                    price: 939,
                    seller: usersDatabase.users[2],
                    description: "test"
                }
            ];
            
            // Игровые данные
            let userBalance = usersDatabase.currentUser.balance;
            let selectedCase = null;
            let selectedDepositAmount = 100;
            let isSpinning = false;
            let stripItems = [];
            let allPossibleItems = [];
            let inventoryData = usersDatabase.currentUser.inventory;
            let historyData = usersDatabase.currentUser.history;
            let currentSection = 'gifts-section';
            let lastWonItem = null;
            let marketListings = JSON.parse(localStorage.getItem('marketListings')) || marketItems;
            let selectedItemForMarket = null;
            
            // Переводы
            const translations = {
                ru: {
                    menuGifts: "Подарки",
                    menuMarket: "Маркет",
                    menuProfile: "Профиль",
                    filterTitle: "Фильтр по цене",
                    settingsTitle: "Настройки",
                    languageLabel: "Язык",
                    depositButton: "Пополнить баланс",
                    inventoryTitle: "Инвентарь",
                    historyTitle: "История",
                    caseOpen: "Открытие кейса",
                    spinButton: "Открыть за",
                    possibleItems: "Возможные предметы",
                    paymentTitle: "Пополнение баланса",
                    wonItemTitle: "Поздравляем!",
                    sellButton: "Продать",
                    keepButton: "Оставить",
                    cancelButton: "Отмена",
                    confirmButton: "Оплатить",
                    marketTitle: "Выставить на маркет",
                    priceLabel: "Цена",
                    descriptionLabel: "Описание (необязательно)",
                    placeMarket: "Выставить",
                    noItems: "Пока нет подарков..",
                    goToGifts: "Подарки!",
                    notificationInsufficient: "Недостаточно средств!",
                    notificationPayment: "Баланс пополнен на",
                    notificationSold: "Предмет продан за",
                    notificationWithdrawn: "Предмет выведен!",
                    notificationMarket: "Предмет выставлен на маркет!",
                    notificationBought: "Предмет куплен!"
                },
                en: {
                    menuGifts: "Gifts",
                    menuMarket: "Market",
                    menuProfile: "Profile",
                    filterTitle: "Price Filter",
                    settingsTitle: "Settings",
                    languageLabel: "Language",
                    depositButton: "Deposit",
                    inventoryTitle: "Inventory",
                    historyTitle: "History",
                    caseOpen: "Case Opening",
                    spinButton: "Open for",
                    possibleItems: "Possible Items",
                    paymentTitle: "Balance Top-up",
                    wonItemTitle: "Congratulations!",
                    sellButton: "Sell",
                    keepButton: "Keep",
                    cancelButton: "Cancel",
                    confirmButton: "Confirm",
                    marketTitle: "List on Market",
                    priceLabel: "Price",
                    descriptionLabel: "Description (optional)",
                    placeMarket: "List Item",
                    noItems: "No gifts yet..",
                    goToGifts: "Gifts!",
                    notificationInsufficient: "Insufficient funds!",
                    notificationPayment: "Balance topped up by",
                    notificationSold: "Item sold for",
                    notificationWithdrawn: "Item withdrawn!",
                    notificationMarket: "Item listed on market!",
                    notificationBought: "Item purchased!"
                }
            };
            
            let currentLanguage = 'ru';
            
            // Функция для применения переводов
            function applyTranslations() {
                const lang = translations[currentLanguage];
                
                // Меню
                document.getElementById('menu-gifts').textContent = lang.menuGifts;
                document.getElementById('menu-market').textContent = lang.menuMarket;
                document.getElementById('menu-profile').textContent = lang.menuProfile;
                
                // Маркет
                document.getElementById('filter-title').textContent = lang.filterTitle;
                
                // Профиль
                document.querySelectorAll('.profile-tab')[0].textContent = lang.settingsTitle;
                document.querySelectorAll('.profile-tab')[1].textContent = lang.inventoryTitle;
                document.querySelectorAll('.profile-tab')[2].textContent = lang.historyTitle;
                document.getElementById('profile-deposit-btn').textContent = lang.depositButton;
                document.querySelector('.section-title').textContent = lang.settingsTitle;
                document.querySelector('.settings-label').textContent = lang.languageLabel;
                
                // Модальное окно кейса
                document.getElementById('case-modal-title').textContent = lang.caseOpen;
                document.getElementById('spin-btn').innerHTML = `${lang.spinButton} <span id="spin-price">0</span> <img src="stars.png" style="width:16px;height:16px;" alt="Coin">`;
                document.getElementById('possible-items-title').textContent = lang.possibleItems;
                
                // Модальное окно оплаты
                document.getElementById('payment-modal-title').textContent = lang.paymentTitle;
                document.getElementById('cancel-payment').textContent = lang.cancelButton;
                document.getElementById('confirm-payment').textContent = lang.confirmButton;
                
                // Модальное окно выигранного предмета
                document.getElementById('won-item-title').textContent = lang.wonItemTitle;
                document.getElementById('sell-item').textContent = lang.sellButton;
                document.getElementById('keep-item').textContent = lang.keepButton;
                
                // Модальное окно маркета
                document.getElementById('market-modal-title').textContent = lang.marketTitle;
                document.getElementById('price-label').textContent = lang.priceLabel;
                document.getElementById('description-label').textContent = lang.descriptionLabel;
                document.getElementById('cancel-market').textContent = lang.cancelButton;
                document.getElementById('confirm-market').textContent = lang.placeMarket;
            }
            
            // Инициализация приложения
            initApp();
            
            function initApp() {
                // Обновляем баланс при загрузке
                updateBalance();
                
                // Обновляем данные пользователя
                updateUserInfo();
                
                // Загружаем кейсы
                loadCases();
                
                // Загружаем маркет
                loadMarketListings();
                
                // Загружаем инвентарь
                loadInventory();
                
                // Применяем переводы
                applyTranslations();
                
                // Настройка обработчиков событий
                setupEventListeners();
            }
            
            // Обновление информации о пользователе
            function updateUserInfo() {
                document.getElementById('user-name').textContent = usersDatabase.currentUser.name;
                document.getElementById('user-avatar').src = usersDatabase.currentUser.avatar;
                document.getElementById('profile-name').innerHTML = `
                    ${usersDatabase.currentUser.name}
                    ${usersDatabase.currentUser.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}
                `;
                document.getElementById('profile-avatar').src = usersDatabase.currentUser.avatar;
                document.getElementById('profile-id').textContent = `ID: ${usersDatabase.currentUser.id}`;
            }
            
            // Загрузка кейсов
            function loadCases() {
                const casesGrid = document.getElementById('cases-grid');
                casesGrid.innerHTML = '';
                
                casesDatabase.forEach(caseItem => {
                    const caseElement = document.createElement('div');
                    caseElement.className = 'card';
                    caseElement.setAttribute('data-id', caseItem.id);
                    
                    caseElement.innerHTML = `
                        <div class="card-image-container">
                            <div class="card-badge">${caseItem.badge}</div>
                            <img src="${caseItem.image}" class="card-image" alt="${caseItem.name}">
                        </div>
                        <div class="card-details">
                            <div class="card-name">${caseItem.name}</div>
                            <div class="card-price">
                                <span>${caseItem.price}</span>
                                <img src="stars.png" class="coin-icon" alt="Coin">
                            </div>
                        </div>
                    `;
                    
                    casesGrid.appendChild(caseElement);
                });
            }
            
            // Загрузка маркета
            function loadMarketListings() {
                const marketListingsEl = document.getElementById('market-listings');
                marketListingsEl.innerHTML = '';
                
                const maxPrice = parseInt(document.getElementById('price-filter').value);
                
                marketListings
                    .filter(item => item.price <= maxPrice)
                    .forEach(item => {
                        const listing = document.createElement('div');
                        listing.className = 'market-listing';
                        
                        listing.innerHTML = `
                            <div class="listing-header">
                                <img src="${item.seller.avatar}" class="listing-avatar" alt="Seller">
                                <div class="listing-user">
                                    ${item.seller.name}
                                    ${item.seller.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}
                                </div>
                            </div>
                            <div class="listing-content">
                                <img src="${item.image}" class="listing-image" alt="${item.name}">
                                <div class="listing-details">
                                    <div class="listing-name">${item.name}</div>
                                    <div class="listing-description">${item.description || 'Без описания'}</div>
                                    <div class="listing-price">
                                        <span>${item.price}</span>
                                        <img src="stars.png" style="width:20px;height:20px;" alt="Coin">
                                    </div>
                                    <button class="listing-buy-btn" data-id="${item.id}">${translations[currentLanguage].confirmButton}</button>
                                </div>
                            </div>
                        `;
                        
                        marketListingsEl.appendChild(listing);
                    });
            }
            
            // Загрузка инвентаря
            function loadInventory() {
                const inventoryGrid = document.getElementById('inventory-grid');
                inventoryGrid.innerHTML = '';
                
                // Если инвентарь пуст
                if (inventoryData.length === 0) {
                    const emptyInventory = document.createElement('div');
                    emptyInventory.className = 'empty-inventory';
                    emptyInventory.innerHTML = `
                        <div class="empty-inventory-icon">
                            <i class="fas fa-box-open"></i>
                        </div>
                        <div class="empty-inventory-text">
                            ${translations[currentLanguage].noItems}
                        </div>
                        <button class="empty-inventory-btn" id="go-to-gifts">
                            ${translations[currentLanguage].goToGifts}
                        </button>
                    `;
                    inventoryGrid.appendChild(emptyInventory);
                    
                    // Добавляем обработчик для кнопки
                    document.getElementById('go-to-gifts').addEventListener('click', function() {
                        switchSection('gifts-section');
                    });
                    return;
                }
                
                inventoryData.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'inventory-item';
                    itemElement.setAttribute('data-id', item.id);
                    
                    itemElement.innerHTML = `
                        <img src="${item.image}" class="inventory-item-image" alt="${item.name}">
                        <div class="inventory-item-name">${item.name}</div>
                        <div class="inventory-buttons">
                            <button class="inventory-btn" data-id="${item.id}">${translations[currentLanguage].placeMarket}</button>
                            <button class="inventory-btn sell" data-id="${item.id}">${translations[currentLanguage].sellButton}</button>
                            <button class="inventory-btn withdraw" data-id="${item.id}">${translations[currentLanguage].withdrawButton || 'Withdraw'}</button>
                        </div>
                    `;
                    
                    inventoryGrid.appendChild(itemElement);
                });
            }
            
            // Настройка обработчиков событий
            function setupEventListeners() {
                // Клик по кейсу
                document.addEventListener('click', function(e) {
                    const card = e.target.closest('.card');
                    if (card && !isSpinning) {
                        const caseId = parseInt(card.getAttribute('data-id'));
                        selectedCase = casesDatabase.find(c => c.id === caseId);
                        
                        if (selectedCase) {
                            openCaseModal(selectedCase);
                        }
                    }
                    
                    // Клик по кнопкам в инвентаре
                    const inventoryBtn = e.target.closest('.inventory-btn');
                    if (inventoryBtn) {
                        const itemId = parseInt(inventoryBtn.getAttribute('data-id'));
                        const item = inventoryData.find(i => i.id === itemId);
                        if (item) {
                            if (inventoryBtn.classList.contains('sell')) {
                                sellInventoryItem(item);
                            } else if (inventoryBtn.classList.contains('withdraw')) {
                                withdrawInventoryItem(item);
                            } else {
                                openMarketModal(item);
                            }
                        }
                    }
                    
                    // Клик по кнопке "Приобрести" на маркете
                    const buyBtn = e.target.closest('.listing-buy-btn');
                    if (buyBtn) {
                        const itemId = parseInt(buyBtn.getAttribute('data-id'));
                        const item = marketListings.find(i => i.id === itemId);
                        if (item) {
                            buyMarketItem(item);
                        }
                    }
                    
                    // Переключение вкладок в профиле
                    const profileTab = e.target.closest('.profile-tab');
                    if (profileTab) {
                        const tabId = profileTab.getAttribute('data-tab');
                        switchProfileTab(tabId);
                    }
                    
                    // Переключение языка
                    const langOption = e.target.closest('.language-option');
                    if (langOption) {
                        const lang = langOption.getAttribute('data-lang');
                        if (lang !== currentLanguage) {
                            document.querySelectorAll('.language-option').forEach(opt => {
                                opt.classList.remove('active');
                            });
                            langOption.classList.add('active');
                            currentLanguage = lang;
                            applyTranslations();
                            loadInventory();
                        }
                    }
                });
                
                // Кнопка пополнения
                document.getElementById('deposit-btn').addEventListener('click', function() {
                    document.getElementById('payment-modal').style.display = 'flex';
                });
                
                document.getElementById('profile-deposit-btn').addEventListener('click', function() {
                    document.getElementById('payment-modal').style.display = 'flex';
                });
                
                // Выбор суммы пополнения
                document.querySelectorAll('.amount-option').forEach(option => {
                    option.addEventListener('click', function() {
                        document.querySelectorAll('.amount-option').forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        selectedDepositAmount = parseInt(this.getAttribute('data-amount'));
                    });
                });
                
                // Отмена платежа
                document.getElementById('cancel-payment').addEventListener('click', function() {
                    document.getElementById('payment-modal').style.display = 'none';
                });
                
                // Подтверждение платежа
                document.getElementById('confirm-payment').addEventListener('click', function() {
                    document.getElementById('payment-modal').style.display = 'none';
                    processPayment(selectedDepositAmount);
                });
                
                // Закрытие модального окна кейса
                document.getElementById('close-case-modal').addEventListener('click', function() {
                    if (!isSpinning) {
                        document.getElementById('case-modal').style.display = 'none';
                    }
                });
                
                // Кнопка крутить
                document.getElementById('spin-btn').addEventListener('click', function() {
                    if (!isSpinning && userBalance >= selectedCase.price) {
                        spinStrip();
                    } else if (isSpinning) {
                        showNotification(translations[currentLanguage].notificationInsufficient);
                    } else {
                        showNotification(translations[currentLanguage].notificationInsufficient);
                    }
                });
                
                // Кнопки в окне выигранного предмета
                document.getElementById('sell-item').addEventListener('click', function() {
                    if (!lastWonItem) return;
                    
                    const sellPrice = lastWonItem.value || selectedCase.price;
                    userBalance += sellPrice;
                    updateBalance();
                    
                    showNotification(`${translations[currentLanguage].notificationSold} ${sellPrice} ${currentLanguage === 'ru' ? 'звезд' : 'stars'}!`);
                    document.getElementById('won-item-modal').style.display = 'none';
                    
                    const historyRecord = {
                        caseId: selectedCase.id,
                        caseName: selectedCase.name,
                        itemId: lastWonItem.id,
                        itemName: lastWonItem.name,
                        date: new Date().toISOString(),
                        price: sellPrice,
                        sold: true
                    };
                    
                    historyData.unshift(historyRecord);
                    usersDatabase.currentUser.history = historyData;
                    lastWonItem = null;
                });
                
                document.getElementById('keep-item').addEventListener('click', function() {
                    if (!lastWonItem) return;
                    
                    inventoryData.unshift({
                        ...lastWonItem,
                        caseId: selectedCase.id,
                        casePrice: selectedCase.price,
                        date: new Date().toISOString()
                    });
                    usersDatabase.currentUser.inventory = inventoryData;
                    
                    document.getElementById('won-item-modal').style.display = 'none';
                    
                    const historyRecord = {
                        caseId: selectedCase.id,
                        caseName: selectedCase.name,
                        itemId: lastWonItem.id,
                        itemName: lastWonItem.name,
                        date: new Date().toISOString(),
                        price: selectedCase.price,
                        sold: false
                    };
                    
                    historyData.unshift(historyRecord);
                    usersDatabase.currentUser.history = historyData;
                    lastWonItem = null;
                });
                
                // Меню навигации
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const tab = this.getAttribute('data-tab');
                        switchSection(tab);
                    });
                });
                
                // Фильтр цены на маркете
                document.getElementById('price-filter').addEventListener('input', function() {
                    document.getElementById('filter-max-price').textContent = this.value;
                    loadMarketListings();
                });
                
                // Подтверждение выставления на маркет
                document.getElementById('confirm-market').addEventListener('click', function() {
                    const price = parseInt(document.getElementById('market-price').value);
                    const description = document.getElementById('market-description').value;
                    
                    if (!price || price <= 0) {
                        showNotification('Укажите корректную цену');
                        return;
                    }
                    
                    // Создаем запись на маркете
                    const newListing = {
                        id: Date.now(),
                        name: selectedItemForMarket.name,
                        image: selectedItemForMarket.image,
                        price: price,
                        description: description,
                        seller: usersDatabase.currentUser
                    };
                    
                    marketListings.push(newListing);
                    localStorage.setItem('marketListings', JSON.stringify(marketListings));
                    
                    // Удаляем предмет из инвентаря
                    const itemIndex = inventoryData.findIndex(i => i.id === selectedItemForMarket.id);
                    if (itemIndex !== -1) {
                        inventoryData.splice(itemIndex, 1);
                        usersDatabase.currentUser.inventory = inventoryData;
                    }
                    
                    showNotification(translations[currentLanguage].notificationMarket);
                    document.getElementById('market-modal').style.display = 'none';
                    loadInventory();
                    loadMarketListings();
                });
                
                // Отмена выставления на маркет
                document.getElementById('cancel-market').addEventListener('click', function() {
                    document.getElementById('market-modal').style.display = 'none';
                });
            }
            
            // Продажа предмета из инвентаря
            function sellInventoryItem(item) {
                const sellPrice = item.value || 100;
                userBalance += sellPrice;
                
                // Удаляем предмет из инвентаря
                const itemIndex = inventoryData.findIndex(i => i.id === item.id);
                if (itemIndex !== -1) {
                    inventoryData.splice(itemIndex, 1);
                    usersDatabase.currentUser.inventory = inventoryData;
                }
                
                updateBalance();
                showNotification(`${translations[currentLanguage].notificationSold} "${item.name}" ${translations[currentLanguage].notificationSold} ${sellPrice} ${currentLanguage === 'ru' ? 'звезд' : 'stars'}!`);
                loadInventory();
                
                // Добавляем запись в историю
                historyData.unshift({
                    itemId: item.id,
                    itemName: item.name,
                    date: new Date().toISOString(),
                    price: sellPrice,
                    type: 'sell'
                });
                usersDatabase.currentUser.history = historyData;
            }
            
            // Вывод предмета
            function withdrawInventoryItem(item) {
                showNotification(`${translations[currentLanguage].notificationWithdrawn} "${item.name}"!`);
                
                // Удаляем предмет из инвентаря
                const itemIndex = inventoryData.findIndex(i => i.id === item.id);
                if (itemIndex !== -1) {
                    inventoryData.splice(itemIndex, 1);
                    usersDatabase.currentUser.inventory = inventoryData;
                }
                
                loadInventory();
                
                // Добавляем запись в историю
                historyData.unshift({
                    itemId: item.id,
                    itemName: item.name,
                    date: new Date().toISOString(),
                    type: 'withdraw'
                });
                usersDatabase.currentUser.history = historyData;
            }
            
            // Открытие модального окна для выставления на маркет
            function openMarketModal(item) {
                selectedItemForMarket = item;
                document.getElementById('market-price').value = item.value || 100;
                document.getElementById('market-description').value = '';
                document.getElementById('market-modal').style.display = 'flex';
            }
            
            // Покупка предмета в маркете
            function buyMarketItem(item) {
                if (userBalance >= item.price) {
                    userBalance -= item.price;
                    updateBalance();
                    
                    // Добавляем предмет в инвентарь покупателя
                    inventoryData.unshift({
                        id: item.id,
                        name: item.name,
                        image: item.image,
                        price: item.price,
                        date: new Date().toISOString()
                    });
                    usersDatabase.currentUser.inventory = inventoryData;
                    
                    // Удаляем предмет с маркета
                    const itemIndex = marketListings.findIndex(i => i.id === item.id);
                    if (itemIndex !== -1) {
                        marketListings.splice(itemIndex, 1);
                        localStorage.setItem('marketListings', JSON.stringify(marketListings));
                    }
                    
                    showNotification(`${translations[currentLanguage].notificationBought} "${item.name}"!`);
                    loadMarketListings();
                    loadInventory();
                    
                    // Добавляем запись в историю
                    historyData.unshift({
                        itemId: item.id,
                        itemName: item.name,
                        date: new Date().toISOString(),
                        price: item.price,
                        type: 'buy'
                    });
                } else {
                    showNotification(translations[currentLanguage].notificationInsufficient);
                }
            }
            
            // Переключение между разделами
            function switchSection(sectionId) {
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                document.getElementById(sectionId).classList.add('active');
                document.querySelector(`.menu-item[data-tab="${sectionId}"]`).classList.add('active');
                
                currentSection = sectionId;
                window.scrollTo(0, 0);
                
                if (sectionId === 'market-section') {
                    loadMarketListings();
                } else if (sectionId === 'profile-section') {
                    loadInventory();
                }
            }
            
            // Переключение вкладок в профиле
            function switchProfileTab(tabId) {
                document.querySelectorAll('.profile-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                document.querySelectorAll('.profile-tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                document.querySelector(`.profile-tab[data-tab="${tabId}"]`).classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
                
                if (tabId === 'inventory') {
                    loadInventory();
                } else if (tabId === 'history') {
                    loadHistory();
                }
            }
            
            // Загрузка истории
            function loadHistory() {
                const historyList = document.getElementById('history-list');
                historyList.innerHTML = '';
                
                historyData.forEach(record => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'settings-item';
                    
                    let content = '';
                    if (record.type === 'buy') {
                        content = `${translations[currentLanguage].notificationBought}: ${record.itemName} ${translations[currentLanguage].notificationFor} ${record.price} <img src="stars.png" style="width:14px;height:14px;" alt="Coin">`;
                    } else if (record.type === 'sell') {
                        content = `${translations[currentLanguage].notificationSold}: ${record.itemName} ${translations[currentLanguage].notificationFor} ${record.price} <img src="stars.png" style="width:14px;height:14px;" alt="Coin">`;
                    } else if (record.type === 'withdraw') {
                        content = `${translations[currentLanguage].notificationWithdrawn}: ${record.itemName}`;
                    } else if (record.caseId) {
                        content = `${translations[currentLanguage].caseOpen}: ${record.caseName} (${record.itemName})`;
                    }
                    
                    const date = new Date(record.date).toLocaleString();
                    
                    historyItem.innerHTML = `
                        <div>${content}</div>
                        <div class="settings-value">${date}</div>
                    `;
                    
                    historyList.appendChild(historyItem);
                });
            }
            
            // Открытие модального окна кейса
            function openCaseModal(caseData) {
                document.getElementById('case-modal-title').textContent = translations[currentLanguage].caseOpen + ": " + caseData.name;
                document.getElementById('spin-price').textContent = caseData.price;
                
                const spinBtn = document.getElementById('spin-btn');
                spinBtn.innerHTML = `${translations[currentLanguage].spinButton} <span id="spin-price">${caseData.price}</span> <img src="stars.png" style="width:16px;height:16px;" alt="Coin">`;
                spinBtn.disabled = userBalance < caseData.price;
                
                const cardsStrip = document.getElementById('cards-strip');
                cardsStrip.innerHTML = '';
                
                stripItems = [];
                caseData.items.forEach(item => {
                    if (item.chance > 0) {
                        for (let i = 0; i < item.chance; i++) {
                            stripItems.push(item);
                        }
                    }
                });
                
                shuffleArray(stripItems);
                
                // Отображаем ВСЕ элементы без ограничений
                for (let i = 0; i < 3; i++) {
                    stripItems.forEach(item => {
                        const stripItem = document.createElement('div');
                        stripItem.className = 'card-strip-item';
                        stripItem.innerHTML = `
                            <img src="${item.image}" class="card-strip-image" alt="${item.name}">
                            <div class="card-strip-name">${item.name}</div>
                        `;
                        cardsStrip.appendChild(stripItem);
                    });
                }
                
                const possibleItemsContainer = document.getElementById('possible-items');
                possibleItemsContainer.innerHTML = '';
                
                allPossibleItems = [...new Set(caseData.items.map(item => item.id))]
                    .map(id => caseData.items.find(item => item.id === id));
                
                allPossibleItems.forEach(item => {
                    const possibleItem = document.createElement('div');
                    possibleItem.className = 'possible-item';
                    possibleItem.innerHTML = `
                        <img src="${item.image}" class="possible-item-image" alt="${item.name}">
                        <div class="possible-item-name">${item.name}</div>
                    `;
                    possibleItemsContainer.appendChild(possibleItem);
                });
                
                document.getElementById('case-modal').style.display = 'flex';
            }
            
            // Прокрутка ленты
            function spinStrip() {
                if (isSpinning) return;
                
                isSpinning = true;
                userBalance -= selectedCase.price;
                updateBalance();
                
                const cardsStrip = document.getElementById('cards-strip');
                const spinBtn = document.getElementById('spin-btn');
                spinBtn.disabled = true;
                
                const randomItem = getRandomItem(selectedCase.items);
                lastWonItem = randomItem;
                
                const itemIndex = stripItems.findIndex(item => item.id === randomItem.id);
                
                const itemWidth = 140 + 12; // Ширина элемента + margin
                const containerWidth = cardsStrip.parentElement.clientWidth;
                const containerCenter = containerWidth / 2;
                const itemCenter = (itemIndex * itemWidth) + (itemWidth / 2);
                
                // Рассчитываем позицию для центрирования выбранного элемента
                const targetPosition = containerCenter - itemCenter - (stripItems.length * itemWidth);
                
                cardsStrip.style.transition = 'none';
                cardsStrip.style.transform = 'translateX(0)';
                
                // Быстрая прокрутка
                setTimeout(() => {
                    cardsStrip.style.transition = 'transform 4s cubic-bezier(0.1, 0.5, 0.3, 1)';
                    cardsStrip.style.transform = `translateX(${targetPosition}px)`;
                }, 50);
                
                // Завершение анимации
                setTimeout(() => {
                    isSpinning = false;
                    spinBtn.disabled = userBalance < selectedCase.price;
                    
                    highlightWonItem(randomItem);
                    
                    setTimeout(() => {
                        showWonItem(randomItem);
                    }, 500);
                }, 4050);
            }
            
            // Подсветка выигранного предмета
            function highlightWonItem(item) {
                const stripItems = document.querySelectorAll('.card-strip-item');
                stripItems.forEach((stripItem) => {
                    const itemName = stripItem.querySelector('.card-strip-name').textContent;
                    if (itemName === item.name) {
                        stripItem.classList.add('highlight');
                        setTimeout(() => {
                            stripItem.classList.remove('highlight');
                        }, 1500);
                    }
                });
            }
            
            // Показ выигранного предмета
            function showWonItem(item) {
                document.getElementById('won-item-image').src = item.image;
                document.getElementById('won-item-name').textContent = item.name;
                
                // Обновляем цену продажи
                const sellPrice = item.value || selectedCase.price;
                document.getElementById('sell-item').textContent = `${translations[currentLanguage].sellButton} ${translations[currentLanguage].notificationFor} ${sellPrice}`;
                
                document.getElementById('won-item-modal').style.display = 'flex';
            }
            
            // Обработка платежа
            function processPayment(amount) {
                const bonus = calculateBonus(amount);
                const total = amount + bonus;
                userBalance += total;
                updateBalance();
                
                showNotification(`${translations[currentLanguage].notificationPayment} ${total} ${currentLanguage === 'ru' ? 'звезд' : 'stars'}!`);
                
                const historyRecord = {
                    type: 'deposit',
                    amount: total,
                    date: new Date().toISOString()
                };
                
                historyData.unshift(historyRecord);
                usersDatabase.currentUser.history = historyData;
            }
            
            // Вспомогательные функции
            function getRandomItem(items) {
                const totalChance = items.reduce((sum, item) => sum + item.chance, 0);
                let random = Math.random() * totalChance;
                
                for (const item of items) {
                    if (random < item.chance) {
                        return item;
                    }
                    random -= item.chance;
                }
                
                return items[0];
            }
            
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }
            
            function calculateBonus(amount) {
                if (amount >= 1000) return Math.floor(amount * 0.3);
                if (amount >= 500) return Math.floor(amount * 0.2);
                if (amount >= 200) return Math.floor(amount * 0.1);
                return 0;
            }
            
            function updateBalance() {
                usersDatabase.currentUser.balance = userBalance;
                document.getElementById('balance-value').textContent = userBalance;
            }
            
            function showNotification(message) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
        });
    </script>
</body>
</html>
